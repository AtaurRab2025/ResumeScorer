<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta
  name="viewport"
  content="width=device-width, initial-scale=1, shrink-to-fit=no"
/>
<title> Prismagic Solutions ‚Üî Resume Match Scorer (Single-File)</title>
<!-- Tailwind (CDN) -->
<script src="https://cdn.tailwindcss.com"></script>
<!-- Chart.js (for the simple bar breakdown) -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<!-- pdf.js (browser) -->
<script src="https://unpkg.com/pdfjs-dist@4.8.69/build/pdf.min.mjs" type="module"></script>
<!-- mammoth (DOCX parser) -->
<script src="https://unpkg.com/mammoth@1.6.0/mammoth.browser.min.js"></script>

<style>
  /* extra polish */
  .glass { backdrop-filter: blur(8px); background: rgba(255,255,255,0.06); }
  .card   { border: 1px solid rgba(255,255,255,0.12); }
  .badge  { border: 1px solid rgba(255,255,255,0.25); }
  .dashed { border: 2px dashed rgba(255,255,255,0.25); }
</style>
</head>
<body class="min-h-screen text-slate-50 bg-gradient-to-br from-slate-900 via-indigo-900 to-fuchsia-900">
  <div class="max-w-6xl mx-auto px-4 py-8">
    <header class="flex flex-col gap-4 md:flex-row md:items-end md:justify-between">
      <div>
        <h1 class="text-3xl md:text-4xl font-black tracking-tight flex items-center gap-3">
          ‚ú® Prismagic Solutions ‚Üî Resume Match Scorer ‚ú®
        </h1>
        <p class="mt-1 text-slate-300 max-w-2xl">
          Paste or upload a Job Description and a Candidate Resume (PDF/DOCX/TXT). Get an instant, explainable score out of 100 with highlights & gaps.
        </p>
      </div>
      <div class="flex gap-2">
        <button id="demoBtn" class="px-4 py-2 rounded-2xl glass card hover:bg-white/10">Demo Data</button>
        <button id="rateBtn" class="px-4 py-2 rounded-2xl bg-fuchsia-500 hover:bg-fuchsia-600 text-white">Rate Now</button>
      </div>
    </header>

    <div class="my-6 h-px bg-white/10"></div>

    <!-- Inputs grid -->
    <section class="grid grid-cols-1 lg:grid-cols-3 gap-6">
      <!-- Client / Role -->
      <div class="glass card rounded-2xl p-4">
        <h3 class="text-lg font-semibold mb-3 flex items-center gap-2">üè¢ Client & Role</h3>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
          <label class="text-sm">Client Name
            <input id="client" class="mt-1 w-full rounded-xl px-3 py-2 bg-white/10 outline-none" placeholder="e.g., Acme Bank" />
          </label>
          <label class="text-sm">Industry
            <input id="industry" class="mt-1 w-full rounded-xl px-3 py-2 bg-white/10 outline-none" placeholder="e.g., BFSI / Healthcare / SaaS" />
          </label>
        </div>
        <label class="text-sm block mt-3">Company LinkedIn Page
          <div class="mt-1 flex gap-2">
            <input id="linkedin" class="w-full rounded-xl px-3 py-2 bg-white/10 outline-none" placeholder="https://www.linkedin.com/company/..." />
            <a id="openLinkedIn" href="#" target="_blank" class="px-3 py-2 rounded-xl glass card hover:bg-white/10">Open</a>
          </div>
        </label>
        <div class="mt-3 flex items-center justify-between rounded-xl bg-white/5 px-3 py-2">
          <span class="text-sm text-slate-300">AutoBoost near-matches</span>
          <label class="inline-flex cursor-pointer items-center">
            <input id="autoboost" type="checkbox" class="peer sr-only" checked />
            <span class="w-11 h-6 bg-white/20 rounded-full relative after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:w-5 after:h-5 after:bg-white after:rounded-full after:transition peer-checked:bg-fuchsia-400/60 peer-checked:after:translate-x-5"></span>
          </label>
        </div>
      </div>

      <!-- JD -->
      <div class="glass card rounded-2xl p-4">
        <h3 class="text-lg font-semibold mb-3 flex items-center gap-2">üéØ Job Description</h3>
        <textarea id="jd" class="w-full min-h-[240px] rounded-xl px-3 py-2 bg-white/10 outline-none" placeholder="Paste the full JD here‚Ä¶"></textarea>
      </div>

      <!-- Resume -->
      <div class="glass card rounded-2xl p-4">
        <h3 class="text-lg font-semibold mb-3 flex items-center gap-2">üíº Candidate Resume</h3>
        <textarea id="resume" class="w-full min-h-[160px] rounded-xl px-3 py-2 bg-white/10 outline-none" placeholder="Paste the resume text here‚Ä¶ or drop a file below"></textarea>
        <div id="dropArea" class="mt-3 rounded-2xl dashed p-6 text-center cursor-pointer hover:bg-white/5 transition">
          <input id="fileInput" type="file" class="hidden" accept=".pdf,.docx,.txt" />
          <p class="text-sm text-slate-300">Drag & drop a PDF, DOCX, or TXT resume here, or click to upload.</p>
          <p id="fileName" class="text-xs text-slate-400 mt-1"></p>
        </div>
      </div>
    </section>

    <!-- Results -->
    <section class="grid grid-cols-1 xl:grid-cols-3 gap-6 mt-8">
      <!-- Overall -->
      <div class="glass card rounded-2xl p-4">
        <h3 class="text-lg font-semibold mb-2 flex items-center gap-2">üìä Overall Match</h3>
        <div class="grid md:grid-cols-2 gap-6 items-center">
          <div class="text-center">
            <div id="bigScore" class="text-6xl font-black">‚Äî</div>
            <div class="text-sm text-slate-300 mt-1">Match out of 100</div>
          </div>
          <div class="space-y-2">
            <div class="text-xs flex justify-between"><span>Skills</span><span id="partSkills">0%</span></div>
            <div class="w-full h-2 bg-white/10 rounded-full overflow-hidden"><div id="barSkills" class="h-full bg-fuchsia-400" style="width:0%"></div></div>

            <div class="text-xs flex justify-between"><span>Responsibilities</span><span id="partResp">0%</span></div>
            <div class="w-full h-2 bg-white/10 rounded-full overflow-hidden"><div id="barResp" class="h-full bg-fuchsia-400" style="width:0%"></div></div>

            <div class="text-xs flex justify-between"><span>Experience</span><span id="partExp">0%</span></div>
            <div class="w-full h-2 bg-white/10 rounded-full overflow-hidden"><div id="barExp" class="h-full bg-fuchsia-400" style="width:0%"></div></div>

            <div class="text-xs flex justify-between"><span>Education</span><span id="partEdu">0%</span></div>
            <div class="w-full h-2 bg-white/10 rounded-full overflow-hidden"><div id="barEdu" class="h-full bg-fuchsia-400" style="width:0%"></div></div>

            <div class="text-xs flex justify-between"><span>Industry</span><span id="partInd">0%</span></div>
            <div class="w-full h-2 bg-white/10 rounded-full overflow-hidden"><div id="barInd" class="h-full bg-fuchsia-400" style="width:0%"></div></div>
          </div>
        </div>
      </div>

      <!-- Highlights & Gaps -->
      <div class="glass card rounded-2xl p-4 xl:col-span-2">
        <h3 class="text-lg font-semibold mb-3 flex items-center gap-2">‚≠ê Highlights & Gaps</h3>
        <div class="grid md:grid-cols-2 gap-6">
          <div>
            <h4 class="text-sm text-slate-200 mb-2">Matched Skills</h4>
            <div id="matchedSkills" class="flex flex-wrap gap-2"></div>
            <div class="grid grid-cols-3 gap-3 mt-4 text-sm">
              <div class="rounded-2xl bg-white/5 p-3 text-center">
                <div class="text-xs text-slate-400">Experience</div>
                <div id="statYears" class="text-lg font-semibold">‚Äî</div>
              </div>
              <div class="rounded-2xl bg-white/5 p-3 text-center">
                <div class="text-xs text-slate-400">Education</div>
                <div id="statEdu" class="text-lg font-semibold">‚Äî</div>
              </div>
              <div class="rounded-2xl bg-white/5 p-3 text-center">
                <div class="text-xs text-slate-400">Responsibilities</div>
                <div id="statResp" class="text-lg font-semibold">‚Äî</div>
              </div>
            </div>
          </div>
          <div>
            <h4 class="text-sm text-slate-200 mb-2">Missing / Low-signal Skills</h4>
            <div id="missingSkills" class="flex flex-wrap gap-2"></div>
            <p class="text-xs text-slate-300 mt-3">Tip: Add concrete bullet points and quantify outcomes. Make sure exact JD phrasing appears in the resume at least once if accurate.</p>
          </div>
        </div>

        <div class="mt-6">
          <h4 class="text-sm text-slate-200 mb-2">Keyword Breakdown</h4>
          <canvas id="breakdownChart" height="120"></canvas>
        </div>

        <div class="mt-6 flex gap-2">
          <button id="exportJson" class="px-4 py-2 rounded-2xl glass card hover:bg-white/10">Export JSON</button>
          <button id="exportCsv" class="px-4 py-2 rounded-2xl glass card hover:bg-white/10">Export CSV</button>
        </div>
      </div>
    </section>

    <p class="mt-6 text-xs text-slate-300">
      ‚ö†Ô∏è Parsing depends on PDF/DOCX quality (scanned PDFs may not extract text). Best results with native PDFs or DOCX.
    </p>
  </div>

<script type="module">
/* ---------------- PDF worker config (must match CDN version) ---------------- */
import * as pdfjsLib from "https://unpkg.com/pdfjs-dist@4.8.69/build/pdf.min.mjs";
pdfjsLib.GlobalWorkerOptions.workerSrc = "https://unpkg.com/pdfjs-dist@4.8.69/build/pdf.worker.min.mjs";

/* ---------------- Heuristic keyword sets ---------------- */
const STOPWORDS = new Set("a,an,the,of,and,or,to,in,on,for,with,by,at,from,as,is,are,was,were,be,been,being,that,which,who,whom,this,these,those,it,its,into,over,under,via,per,within,without,across,about,between,but,so,if,than,then,can,could,should,would,may,might,will,shall,do,does,did,done,have,has,had,having,you,your,we,our,they,them,their,i,me,my,he,she,him,her,his,hers,us".split(","));
const COMMON_SKILLS = [
  "sql","python","java","c#","javascript","typescript","react","node","aws","azure","gcp","snowflake","databricks","power bi","tableau","hadoop","spark","kafka","airflow","oracle","mysql","postgres","etl","data governance","data quality","mdm","collibra","informatica","jira","confluence","git","docker","kubernetes","linux","rest","microservices","agile","scrum","saas","salesforce","servicenow","tensorflow","pytorch","nlp","ml","ai","nosql","mongodb","redis","elastic","terraform","ansible","ci/cd","devops"
];
const RESPONSIBILITY_VERBS = [
  "lead","manage","design","implement","deliver","own","drive","optimize","improve","build","develop","architect","deploy","maintain","monitor","analyze","collaborate","coordinate","mentor","present","document","govern","migrate","automate"
];
const EDUCATION_TERMS = [
  "bachelor","bachelors","b.sc","bsc","btech","b.tech","be","b.e","master","masters","m.sc","msc","mtech","m.tech","ms","mba","phd","doctorate"
];
const SYNS = {
  "sql": ["structured query language","t-sql","pl/sql","postgresql","mysql","oracle"],
  "python": ["pandas","numpy","scikit","py"],
  "javascript": ["js","node","typescript","ts"],
  "aws": ["amazon web services","ec2","s3","lambda","athena","glue"],
  "azure": ["synapse","adf","databricks","azure devops"],
  "gcp": ["google cloud","bigquery","gke"],
  "data governance": ["governance","collibra","data policies","lineage"],
  "data quality": ["dq","data validation","data profiling"],
  "etl": ["elt","data pipeline","ingestion"]
};

/* ---------------- Utility helpers ---------------- */
const $ = (id) => document.getElementById(id);

function normalize(text="") {
  return text.toLowerCase().replace(/[^a-z0-9+.#/\-\s]/g," ").replace(/\s+/g," ").trim();
}
function tokens(text) {
  return normalize(text).split(" ").filter(t => t && !STOPWORDS.has(t));
}
function containsAny(hay, arr) {
  const h = normalize(hay);
  return arr.some(n => h.includes(normalize(n)));
}
function uniq(arr) { return Array.from(new Set(arr)); }

/* ---------------- Extractors ---------------- */
function extractKeywordsFromJD(jd) {
  const tks = tokens(jd);
  const skills = COMMON_SKILLS.filter(s => containsAny(jd, [s, ...(SYNS[s]||[])]));
  const verbs  = RESPONSIBILITY_VERBS.filter(v => tks.includes(v));
  const yearsMatch = jd.match(/(\d+)[+ ]*years?/i);
  const minYears = yearsMatch ? parseInt(yearsMatch[1],10) : null;
  const eduReq = EDUCATION_TERMS.filter(e => containsAny(jd,[e]));
  return { skills: uniq(skills), verbs: uniq(verbs), minYears, eduReq: uniq(eduReq) };
}
function extractFromResume(cv) {
  const tks = tokens(cv);
  const skills = uniq(COMMON_SKILLS.filter(s => containsAny(cv, [s, ...(SYNS[s]||[])])));
  const verbs  = uniq(RESPONSIBILITY_VERBS.filter(v => tks.includes(v)));
  const years = (() => {
    const m = cv.match(/(\d+)[+ ]*years? of (overall|total)?\s*experience/i);
    if (m) return parseInt(m[1],10);
    const alt = cv.match(/(\d+)[+ ]*years?/i);
    return alt ? parseInt(alt[1],10) : null;
  })();
  const edu = uniq(EDUCATION_TERMS.filter(e => containsAny(cv,[e])));
  return { skills, verbs, years, edu };
}

/* ---------------- Scoring ---------------- */
function scoreMatch(jdText, cvText, industry, autoBoost=true) {
  const jd = extractKeywordsFromJD(jdText);
  const cv = extractFromResume(cvText);

  // Skills (40)
  const need = jd.skills.length || 1;
  let hits = 0;
  for (const s of jd.skills) {
    const syns = SYNS[s] || [];
    if (containsAny(cvText, [s, ...syns])) hits++;
  }
  const skillsScore = Math.round((hits/need)*40);

  // Responsibilities (25)
  const rvNeed = jd.verbs.length || 1;
  const rvHit  = jd.verbs.filter(v => cv.verbs.includes(v)).length;
  const respScore = Math.round((rvHit/rvNeed)*25);

  // Experience (15)
  let expScore = 15;
  if (jd.minYears && cv.years != null) {
    const ratio = Math.min(cv.years / jd.minYears, 1);
    expScore = Math.round(ratio*15);
  } else if (jd.minYears && cv.years == null) {
    expScore = Math.round(15*0.5);
  }

  // Education (10)
  const eduNeed = jd.eduReq.length;
  let eduScore = 10;
  if (eduNeed > 0) {
    const eduHit = jd.eduReq.filter(e => cv.edu.includes(e)).length;
    eduScore = Math.round((eduHit / Math.max(eduNeed,1)) * 10);
  }

  // Industry (10)
  const indScore = industry ? (containsAny(cvText, [industry]) ? 10 : 6) : 8;

  let total = Math.min(skillsScore + respScore + expScore + eduScore + indScore, 100);

  // Slight boost for near-misses
  const missingSkills = jd.skills.filter(s => !containsAny(cvText, [s, ...(SYNS[s]||[])]));
  if (autoBoost && missingSkills.length > 0 && missingSkills.length <= 2 && respScore >= 18 && skillsScore >= 28) {
    total = Math.min(100, total + 2);
  }
  const matchedSkills = jd.skills.filter(s => !missingSkills.includes(s));

  return {
    total,
    parts: { Skills: skillsScore, Responsibilities: respScore, Experience: expScore, Education: eduScore, Industry: indScore },
    jd, cv, matchedSkills, missingSkills
  };
}

/* ---------------- PDF / DOCX / TXT parsing ---------------- */
async function parsePDF(file) {
  const ab = await file.arrayBuffer();
  const pdf = await pdfjsLib.getDocument({ data: ab }).promise;
  let text = "";
  for (let i = 1; i <= pdf.numPages; i++) {
    const page = await pdf.getPage(i);
    const content = await page.getTextContent();
    const strings = content.items.map(it => it.str || "");
    text += strings.join(" ") + "\n";
  }
  return text;
}
async function parseDOCX(file) {
  const ab = await file.arrayBuffer();
  const res = await window.mammoth.extractRawText({ arrayBuffer: ab });
  return res.value || "";
}

/* ---------------- UI handlers ---------------- */
const clientEl   = $("client");
const industryEl = $("industry");
const linkedinEl = $("linkedin");
const openLinkEl = $("openLinkedIn");
const autoBoostEl= $("autoboost");
const jdEl       = $("jd");
const resumeEl   = $("resume");
const dropArea   = $("dropArea");
const fileInput  = $("fileInput");
const fileNameEl = $("fileName");

openLinkEl.addEventListener("click", (e) => {
  const url = linkedinEl.value.trim();
  if (!url) e.preventDefault();
  else openLinkEl.href = url;
});

dropArea.addEventListener("click", () => fileInput.click());
dropArea.addEventListener("dragover", (e) => { e.preventDefault(); dropArea.classList.add("bg-white/10"); });
dropArea.addEventListener("dragleave", () => dropArea.classList.remove("bg-white/10"));
dropArea.addEventListener("drop", async (e) => {
  e.preventDefault();
  dropArea.classList.remove("bg-white/10");
  const file = e.dataTransfer.files?.[0];
  if (file) await handleFile(file);
});
fileInput.addEventListener("change", async (e) => {
  const file = e.target.files?.[0];
  if (file) await handleFile(file);
});

async function handleFile(file) {
  fileNameEl.textContent = file.name;
  const ext = (file.name.split(".").pop() || "").toLowerCase();
  try {
    let text = "";
    if (ext === "pdf") text = await parsePDF(file);
    else if (ext === "docx") text = await parseDOCX(file);
    else if (ext === "txt")  text = await file.text();
    else return alert("Unsupported file. Please upload PDF, DOCX, or TXT.");

    resumeEl.value = (resumeEl.value + "\n" + text).trim();
  } catch (err) {
    console.error(err);
    alert("Error parsing file. Try a different file.");
  }
}

/* ---------------- Chart setup ---------------- */
let chart;
function drawChart(parts) {
  const ctx = $("breakdownChart").getContext("2d");
  const labels = Object.keys(parts);
  const data   = Object.values(parts);
  if (chart) chart.destroy();
  chart = new Chart(ctx, {
    type: "bar",
    data: { labels, datasets: [{ label: "Score", data }] },
    options: {
      responsive: true,
      plugins: { legend: { display: false } },
      scales: { y: { beginAtZero: true, max: 40 } }
    }
  });
}

/* ---------------- Render results ---------------- */
function setBar(id, pct) {
  $(id).style.width = pct + "%";
}
function setText(id, text) {
  $(id).textContent = text;
}
function renderBadges(containerId, items, variant="solid") {
  const el = $(containerId);
  el.innerHTML = "";
  if (!items || !items.length) {
    el.innerHTML = `<span class="text-xs text-slate-400">None</span>`;
    return;
  }
  items.forEach(s => {
    const span = document.createElement("span");
    span.className = "badge rounded-full px-2 py-1 text-xs " + (variant==="outline" ? "bg-transparent" : "bg-white/10");
    span.textContent = s;
    el.appendChild(span);
  });
}

/* ---------------- Export helpers ---------------- */
function download(filename, content, mime="text/plain") {
  const blob = new Blob([content], { type: mime });
  const url = URL.createObjectURL(blob);
  const a = document.createElement("a");
  a.href = url; a.download = filename; a.click();
  URL.revokeObjectURL(url);
}

/* ---------------- Demo & Rate ---------------- */
$("demoBtn").addEventListener("click", () => {
  clientEl.value   = "Acme Bank";
  industryEl.value = "Banking / BFSI";
  linkedinEl.value = "https://www.linkedin.com/company/acme-bank";
  jdEl.value = `We are hiring a Senior Data Governance Analyst with 7+ years experience. Must have strong SQL, Data Quality, and Data Governance expertise, hands-on with Collibra or Informatica, and ETL on Snowflake/Azure. Responsibilities include designing governance policies, building data lineage, collaborating with cross-functional teams, and improving DQ metrics. Bachelor's required; Master's preferred.`;
  resumeEl.value = `Senior Data Analyst with 8 years of total experience. Strong SQL (PostgreSQL, Oracle), Python (Pandas), ETL on Snowflake and Azure Data Factory. Implemented data profiling and data quality rules, built lineage documentation, and collaborated with engineering & business teams. Familiar with Collibra. Led initiatives to optimize pipelines and automate validation. Education: B.Tech in Computer Science.`;
});

$("rateBtn").addEventListener("click", () => {
  const client   = clientEl.value.trim();
  const industry = industryEl.value.trim();
  const linkedin = linkedinEl.value.trim();
  const jd       = jdEl.value.trim();
  const resume   = resumeEl.value.trim();
  const canScore = jd.length > 30 && resume.length > 30;
  if (!canScore) {
    alert("Please provide both JD and Resume with at least ~30 characters each.");
    return;
  }
  const res = scoreMatch(jd, resume, industry, autoBoostEl.checked);

  // Numbers
  setText("bigScore", res.total);
  setText("partSkills", res.parts.Skills + "%");
  setText("partResp",   res.parts.Responsibilities + "%");
  setText("partExp",    res.parts.Experience + "%");
  setText("partEdu",    res.parts.Education + "%");
  setText("partInd",    res.parts.Industry + "%");

  setBar("barSkills", res.parts.Skills);
  setBar("barResp",   res.parts.Responsibilities);
  setBar("barExp",    res.parts.Experience);
  setBar("barEdu",    res.parts.Education);
  setBar("barInd",    res.parts.Industry);

  // Stats
  setText("statYears", (res.cv.years ?? "‚Äî") + (res.cv.years ? " yrs" : ""));
  setText("statEdu", res.cv.edu.join(", ") || "‚Äî");
  setText("statResp", `${res.jd.verbs.filter(v => res.cv.verbs.includes(v)).length}/${res.jd.verbs.length}`);

  // Badges
  renderBadges("matchedSkills", res.matchedSkills, "solid");
  renderBadges("missingSkills", res.missingSkills, "outline");

  drawChart(res.parts);

  // Save last result for exports
  window.__lastResult = {
    timestamp: new Date().toISOString(),
    client, industry, linkedin, jd, resume,
    total: res.total, parts: res.parts
  };
});

$("exportJson").addEventListener("click", () => {
  const r = window.__lastResult;
  if (!r) return alert("Please rate first.");
  download(`jd-resume-score-${(r.client||"client").replace(/\W+/g,"-")}.json`, JSON.stringify(r, null, 2), "application/json");
});
$("exportCsv").addEventListener("click", () => {
  const r = window.__lastResult;
  if (!r) return alert("Please rate first.");
  const headers = ["client","industry","linkedin","total","skills","responsibilities","experience","education","industry_score"];
  const row = [
    r.client||"", r.industry||"", r.linkedin||"", r.total,
    r.parts.Skills, r.parts.Responsibilities, r.parts.Experience, r.parts.Education, r.parts.Industry
  ];
  const csv = headers.join(",") + "\n" + row.join(",");
  download(`jd-resume-score-${(r.client||"client").replace(/\W+/g,"-")}.csv`, csv, "text/csv");
});
</script>
</body>
</html>
